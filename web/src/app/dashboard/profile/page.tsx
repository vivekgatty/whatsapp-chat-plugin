'use client'; /** Edit Business Profile Î“Ã‡Ã¶ restored (2025-11-01_09-50-19)  * - Client component to avoid server crashes  * - Country dropdown (all countries via Intl.DisplayNames)  * - Dial code input with common-code suggestions (datalist) Î“Ã‡Ã¶ user can enter ANY code  * - Working hours grid (MonÎ“Ã‡Ã´Sun) with time inputs + Closed toggle  * - Safe fetch/POST with toasts; never throws  */  import React from 'react';  type Biz = {   name?: string;   website?: string;   email?: string;   country?: string;    // ISO 3166-1 alpha-2   dialCode?: string;   // e.g. +91   phone?: string;      // local phone part   hours?: Record<string, { open: string; close: string; closed: boolean }>; };  const DAYS: Array<{ key: string; label: string }> = [   { key: 'mon', label: 'Mon' },   { key: 'tue', label: 'Tue' },   { key: 'wed', label: 'Wed' },   { key: 'thu', label: 'Thu' },   { key: 'fri', label: 'Fri' },   { key: 'sat', label: 'Sat' },   { key: 'sun', label: 'Sun' }, ];  function defaultHours(): Biz['hours'] {   const base = { open: '09:00', close: '18:00', closed: false };   return {     mon: { ...base },     tue: { ...base },     wed: { ...base },     thu: { ...base },     fri: { ...base },     sat: { ...base },     sun: { ...base, closed: true },   }; }  // Common dial codes as suggestions (user can still type any code) const COMMON_DIALS = [   '+1', '+7', '+20', '+27', '+30', '+31', '+32', '+33', '+34', '+36', '+39',   '+40', '+41', '+43', '+44', '+45', '+46', '+47', '+48', '+49', '+52', '+53',   '+54', '+55', '+56', '+57', '+58', '+60', '+61', '+62', '+63', '+64', '+65',   '+66', '+81', '+82', '+84', '+86', '+90', '+91', '+92', '+93', '+94', '+95',   '+98', '+212', '+213', '+216', '+218', '+220', '+221', '+234', '+251', '+254',   '+256', '+263', '+298', '+351', '+352', '+353', '+354', '+355', '+356', '+357',   '+358', '+359', '+370', '+371', '+372', '+373', '+374', '+375', '+376', '+377',   '+378', '+380', '+381', '+382', '+383', '+385', '+386', '+387', '+389', '+420',   '+421', '+423', '+500', '+501', '+502', '+503', '+504', '+505', '+506', '+507',   '+508', '+509', '+590', '+591', '+592', '+593', '+594', '+595', '+596', '+597',   '+598', '+599', '+670', '+673', '+675', '+676', '+677', '+678', '+679', '+680',   '+681', '+682', '+683', '+685', '+686', '+687', '+688', '+689', '+690', '+691',   '+692', '+850', '+852', '+853', '+855', '+856', '+870', '+871', '+872', '+873',   '+874', '+875', '+876', '+877', '+878', '+880', '+886', '+960', '+961', '+962',   '+963', '+964', '+965', '+966', '+967', '+968', '+970', '+971', '+972', '+973',   '+974', '+975', '+976', '+977', '+978', '+992', '+993', '+994', '+995', '+996',   '+998' ];  function getAllCountries(): Array<{ code: string; name: string }> {   try {     // Modern browsers: list all regions     const regions = (Intl as any).supportedValuesOf?.('region') as string[] | undefined;     if (regions && regions.length) {       const dn = new Intl.DisplayNames(['en'], { type: 'region' });       return regions         .map((r) => ({ code: r, name: (dn.of(r) as string) ?? r }))         .filter((c) => /^[A-Z]{2}$/.test(c.code))         .sort((a, b) => a.name.localeCompare(b.name));     }   } catch {}   // Fallback minimal list (kept tiny; user can still type any dialCode)   return [     { code: 'IN', name: 'India' },     { code: 'US', name: 'United States' },     { code: 'GB', name: 'United Kingdom' },     { code: 'AE', name: 'United Arab Emirates' },     { code: 'SG', name: 'Singapore' },     { code: 'AU', name: 'Australia' },     { code: 'DE', name: 'Germany' },     { code: 'FR', name: 'France' },     { code: 'ZA', name: 'South Africa' },   ]; }  export default function Page() {   const [loading, setLoading] = React.useState(true);   const [saving, setSaving]   = React.useState(false);   const [error, setError]     = React.useState<string|undefined>();   const [ok, setOk]           = React.useState<string|undefined>();    const [biz, setBiz] = React.useState<Biz>({     name: '',     website: 'https://chatmadi.com',     email: 'admin@chatmadi.com',     country: 'IN',     dialCode: '+91',     phone: '',     hours: defaultHours(),   });    React.useEffect(() => {     let cancelled = false;     (async () => {       try {         const r = await fetch('/api/business/overview', { cache: 'no-store' });         if (!r.ok) throw new Error('overview_not_ok');         const j = await r.json();         const incoming: Biz = {           name: j?.business?.name ?? biz.name,           website: j?.business?.website ?? biz.website,           email: j?.business?.email ?? biz.email,           country: j?.business?.country ?? biz.country,           dialCode: j?.business?.dialCode ?? biz.dialCode,           phone: j?.business?.phone ?? biz.phone,           hours: j?.business?.hours ?? biz.hours,         };         if (!cancelled) setBiz(incoming);       } catch {         // Silent fallback: defaults remain       } finally {         if (!cancelled) setLoading(false);       }     })();     return () => { cancelled = true; };   // eslint-disable-next-line react-hooks/exhaustive-deps   }, []);    const countries = React.useMemo(getAllCountries, []);   const onField = (k: keyof Biz, v: any) => setBiz((b) => ({ ...b, [k]: v }));    async function save(e: React.FormEvent) {     e.preventDefault();     setSaving(true); setError(undefined); setOk(undefined);     try {       const r = await fetch('/api/business/overview', {         method: 'POST',         headers: { 'Content-Type': 'application/json' },         body: JSON.stringify(biz),       });       if (!r.ok) throw new Error('save_failed');       setOk('Saved.');     } catch (err: any) {       setError('Could not save right now. Your changes are still on screen.');     } finally {       setSaving(false);     }   }    function setHour(day: string, part: 'open'|'close'|'closed', value: string|boolean) {     setBiz((b) => ({       ...b,       hours: {         ...(b.hours ?? defaultHours()),         [day]: { ...(b.hours?.[day] ?? { open: '09:00', close: '18:00', closed: false }), [part]: value as any }       }     }));   }    return (     <div className="max-w-3xl mx-auto px-4 py-6 space-y-6">       <h1 className="text-2xl font-semibold">Edit business profile</h1>        {loading ? (         <div className="text-slate-300">LoadingÎ“Ã‡Âª</div>       ) : (         <form onSubmit={save} className="space-y-6">           {/* Basic details */}           <div className="grid grid-cols-1 md:grid-cols-2 gap-4">             <div>               <label className="block text-sm mb-1">Business name</label>               <input                 className="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2"                 value={biz.name ?? ''}                 onChange={(e) => onField('name', e.target.value)}                 placeholder="Your company"                 required               />             </div>             <div>               <label className="block text-sm mb-1">Website</label>               <input                 className="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2"                 value={biz.website ?? ''}                 onChange={(e) => onField('website', e.target.value)}                 placeholder="https://example.com"                 pattern="https?://.+"                 required               />             </div>             <div>               <label className="block text-sm mb-1">Email</label>               <input                 type="email"                 className="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2"                 value={biz.email ?? ''}                 onChange={(e) => onField('email', e.target.value)}                 placeholder="you@company.com"                 required               />             </div>              {/* Country + phone */}             <div className="grid grid-cols-[1fr] gap-3">               <label className="block text-sm mb-1">Country</label>               <select                 className="bg-slate-900 border border-slate-700 rounded px-3 py-2"                 value={biz.country ?? 'IN'}                 onChange={(e) => onField('country', e.target.value)}               >                 {countries.map((c) => (                   <option key={c.code} value={c.code}>{c.name}</option>                 ))}               </select>             </div>             <div className="grid grid-cols-[120px_1fr] gap-3 md:col-span-2">               <div>                 <label className="block text-sm mb-1">Dial code</label>                 <input                   list="dial-codes"                   className="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2"                   value={biz.dialCode ?? '+91'}                   onChange={(e) => onField('dialCode', e.target.value)}                   placeholder="+91"                   pattern="^\+[\d]{1,4}$"                   required                 />                 <datalist id="dial-codes">                   {COMMON_DIALS.map((d) => <option key={d} value={d} />)}                 </datalist>               </div>               <div>                 <label className="block text-sm mb-1">Phone number</label>                 <input                   type="tel"                   className="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2"                   value={biz.phone ?? ''}                   onChange={(e) => onField('phone', e.target.value)}                   placeholder="9740333189"                   required                 />               </div>             </div>           </div>            {/* Working hours */}           <div>             <div className="font-medium mb-2">Working hours</div>             <div className="grid grid-cols-1 gap-2">               {DAYS.map(({ key, label }) => { const hours = (biz.hours ?? defaultHours()) as NonNullable<Biz["hours"]>;                 const row = (hours as any)[key] ?? { open: '09:00', close: '18:00', closed: false };                 return (                   <div key={key} className="grid grid-cols-[60px_120px_24px_120px_auto] items-center gap-3">                     <div className="text-sm text-slate-300">{label}</div>                     <input                       type="time"                       className="bg-slate-900 border border-slate-700 rounded px-2 py-1"                       value={row.open}                       onChange={(e) => setHour(key, 'open', e.target.value)}                       disabled={row.closed}                       required={!row.closed}                     />                     <span className="text-center opacity-70">Î“Ã‡Ã¶</span>                     <input                       type="time"                       className="bg-slate-900 border border-slate-700 rounded px-2 py-1"                       value={row.close}                       onChange={(e) => setHour(key, 'close', e.target.value)}                       disabled={row.closed}                       required={!row.closed}                     />                     <label className="inline-flex items-center gap-2 text-sm">                       <input                         type="checkbox"                         checked={row.closed}                         onChange={(e) => setHour(key, 'closed', e.target.checked)}                       />                       Closed                     </label>                   </div>                 );               })}             </div>           </div>            {/* Actions */}           <div className="flex items-center gap-3">             <button               type="submit"               disabled={saving}               className="bg-emerald-600 hover:bg-emerald-700 rounded px-4 py-2 disabled:opacity-60"             >               {saving ? 'SavingÎ“Ã‡Âª' : 'Save'}             </button>             <a href="/dashboard" className="text-sky-400 hover:underline">Î“Ã¥Ã‰ Back to dashboard</a>           </div>            {error && <div className="text-red-400 text-sm">{error}</div>}           {ok && <div className="text-emerald-400 text-sm">{ok}</div>}         </form>       )}     </div>   ); }